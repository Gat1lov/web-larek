# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Немного про шаблон проектирования MVP
Model-View-Presenter (MVP) - это шаблон проектирования программного обеспечения, который используется для построения пользовательских интерфейсов. Он разделяет приложение на три основных компонента: модель (Model), представление (View) и презентер (Presenter). Каждый из этих компонентов выполняет свою уникальную функцию, что облегчает разделение ответственностей и обеспечивает лучшую структуру и сопровождаемость кода.

Вот краткое описание каждого компонента:

### 1. Модель (Model):
- Модель представляет собой компонент, отвечающий за бизнес-логику и управление данными.
- Она содержит данные и методы для их обработки, включая взаимодействие с базой данных, работу с файлами и т. д.
- Модель не зависит от представления или презентера, что делает ее переиспользуемой и независимой от интерфейса.

### 2. Представление (View):
- Представление отвечает за отображение данных пользователю и получение от него ввода.
- Это может быть графический интерфейс пользователя (GUI), веб-страница, консольное окно или любой другой способ взаимодействия с пользователем.

### 3. Презентер (Presenter):
- Презентер является посредником между моделью и представлением.
- Он получает данные от модели, обрабатывает их и обновляет представление.
- Презентер также обрабатывает пользовательский ввод, преобразуя его в действия, которые модель может понять и обработать.
- Цель презентера - разделить бизнес-логику от отображения и обеспечить тестирование логики без зависимости от интерфейса.

## Интерфейсы
### IProductItem // Интерфейс описывающий карточку продукта

```
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
```

### IOrderResult // Интерфейс описывающий успешный результат получаемый от сервера
```
    id: string;
    total: number;
```

### IContactForm // Интерфейс описывающий форму контактов пользователя
```
    email: string;
    phone: string;
```

### IDeliveryForm // Интерфейс описывающий адрес доставки и способ оплаты пользователя
```
    address: string;
    payment: PaymentMethod;
```

### IOrder // Интерфейс описывающий форму заказа пользователя
```
    total: number;
    items: string[];
```

### IAppState // Интерфейс описывающий состояние пользуемого приложения
```
    catalog: IProductItem[];
    basket: string[];
    preview: string | null;
    contact: IContactForm | null;
    delivery: IDeliveryForm | null;
    order: IOrder | null;
```

### IAction // Интерфейс описывающий структуру объекта
```
    onClick: (event: MouseEvent) => void;
```

### IBasketView //Интерфейс описывающий корзину
```
    items: HTMLElement[];
    total: number;
    selected: string[];
```

### IModalData // Интерфейс описывающий контент модального окна
```
    content: HTMLElement;
```

### ISuccess // Интерфейс описывающий успех и его номер
```
    total: number;
```

### IFormState // Интерфейс валидации форм
```
    valid: boolean;
    errors: string[];
```

### IWebLarekAPI // Интерфейс описывающий получение данных с сервера
```
    getProductsList: () => Promise<IProductItem[]>;
    getProduct: (id: string) => Promise<IProductItem>;
    orderProduct: (order: IOrder) => Promise<IOrderResult>
```
### IProductCard // Интерфейс расширяющий карточку продукта
```
    text: string;
    count?: number;
    buttonText?: string;
```
### ICard // Тип добавляющий свойства кнопке
```
    text: string;
    button: string
    count?: number;
```
### IContactsForm //Интерфейс описывающий форму контактов пользователя
```
    email: string;
    phone: string;
```
### IPage //Интерфейс описывающий страницу
```
    counter: number;
    catalog: HTMLElement[];
    locked: boolean;
```

## Слой Model
### Класс Model
- Этот абстрактный класс предоставляет базовую функциональность для работы с данными модели и обеспечивает возможность уведомлять другие компоненты о изменениях данных путем эмитирования событий. Он может быть расширен для создания конкретных моделей данных в приложении.

    - `Model<T>:` Обобщенный абстрактный класс, параметризованный типом T, который представляет данные модели.
    - `constructor(data: Partial<T>, protected events: IEvents):` Конструктор класса, который принимает частичные данные модели и объект `events`, реализующий интерфейс `IEvents`. Внутри конструктора данные копируются в экземпляр класса с помощью `Object.assign()`.
    - `emitChanges(event: string, payload?: object):` Метод для эмиттирования события изменений. Принимает имя события и необязательный объект данных `payload`, который передается вместе с событием. Если `payload` не указан, передается пустой объект `{}`.

## Слой View
### Класс Component
- Этот абстрактный класс обеспечивает ряд удобных методов для работы с элементами DOM и предоставляет основу для создания пользовательских компонентов, которые могут быть дальше расширены и настроены в подклассах.

    - `Component<T>:` Обобщенный абстрактный класс, параметризованный типом T, который представляет данные компонента.
    - `constructor(protected readonly container: HTMLElement):` Конструктор класса, который принимает элемент DOM (`HTMLElement`) в качестве контейнера для компонента.
    - `toggleClass(element: HTMLElement, className: string, force?: boolean):` Метод для переключения класса CSS для указанного элемента. Если `force` задано, класс будет добавлен, если `true`, и удален, если `false`.
    - `setText(element: HTMLElement, value: unknown):` Метод для установки текстового содержимого для указанного элемента DOM.
    - `setDisabled(element: HTMLElement, state: boolean):` Метод для установки состояния "disabled" для указанного элемента DOM.
    - `setHidden(element: HTMLElement):` Метод для скрытия указанного элемента DOM, устанавливая его стиль `display` в `none`.
    - `setVisible(element: HTMLElement):` Метод для отображения указанного элемента DOM, удаляя стиль `display`.
    - `setImage(element: HTMLImageElement, src: string, alt?: string):` Метод для установки изображения для элемента `img`.
    - `render(data?: Partial<T>): HTMLElement:` Метод для отрисовки компонента на основе данных `data`, которые могут быть переданы в качестве аргумента. Этот метод должен быть реализован в подклассах для создания специфичного представления компонента.

### Класс EventEmitter
- Этот класс предоставляет основные методы для работы с событиями и может быть использован для создания и управления пользовательскими событиями в TypeScript-приложениях.

    - `_events: Map<EventName, Set<Subscriber>>:` Приватное свойство, которое представляет собой карту событий, где ключом является имя события, а значением является набор подписчиков на это событие.
    - `constructor():` Конструктор класса, который инициализирует _events как пустую карту.
    - `on(eventName: EventName, callback: (event: T) => void):` Метод для подписки на событие. Принимает имя события и функцию обратного вызова, которая будет вызвана при возникновении этого события.
    - `off(eventName: EventName, callback: Subscriber):` Метод для отписки от события. Принимает имя события и функцию обратного вызова, которую нужно удалить из списка подписчиков этого события.
    - `emit(eventName: string, data?: T):` Метод для эмиттирования события. Принимает имя события и необязательные данные, которые будут переданы подписчикам этого события.
    - `onAll(callback: (event: EmitterEvent) => void):` Метод для подписки на все события. При вызове этого метода указанная функция обратного вызова будет вызываться при возникновении любого события.
    - `offAll():` Метод для отписки от всех событий.
    - `trigger(eventName: string, context?: Partial<T>):` Метод, который возвращает функцию, предназначенную для вызова события с указанным именем и контекстом данных.

### Класс Basket
- Представляет корзину для товаров на веб-странице и содержит методы и свойства для работы с корзиной.
    - `constructor(container: HTMLElement, events: EventEmitter):` Конструктор класса. Принимает контейнер корзины (`HTMLElement`) и объект событий (`EventEmitter`). Инициализирует элементы корзины и устанавливает слушатель события на кнопку заказа.
    - `items:` Свойство, позволяющее установить список товаров в корзине. Принимает массив `HTMLElement`, который представляет собой элементы товаров в корзине.
    - `selected:` Свойство, позволяющее установить выбранные товары в корзине. Принимает массив строк, представляющих выбранные товары.
    - `total:` Свойство, позволяющее установить общую сумму заказа. Принимает числовое значение - общую сумму заказа.

### Класс Form
- Представляет форму веб-страницы и содержит методы и свойства для работы с этой формой.
    - `constructor(container: HTMLFormElement, events: IEvents):` Конструктор класса. Принимает контейнер формы `(HTMLFormElement)` и объект событий `(IEvents)`. Инициализирует кнопку отправки формы и элемент для отображения ошибок. Устанавливает слушатели событий на изменение полей формы и отправку формы.
    - `onInputChange(field: keyof T, value: string):` Защищенный метод. Вызывается при изменении значения поля формы. Генерирует событие с указанием измененного поля и его значения.
    - `valid:` Свойство, позволяющее установить доступность кнопки отправки формы. Принимает булево значение.
    - `errors:` Свойство, позволяющее установить текст сообщения об ошибке.
    - `render(state: Partial<T> & IFormState):` Метод, рендерящий форму с учетом переданного состояния. Принимает объект состояния формы и обновляет отображение формы в соответствии с этим состоянием.

### Класс Modal
- Представляет собой компонент модального окна.
    - `open():` Устанавливает модальному окну состояние активности, добавляя CSS-класс (`modal_active`) и генерирует событие, указывающее, что модальное окно было открыто.
    - `close():` Закрывает модальное окно, удаляя CSS-класс (`modal_active`) из контейнера модального окна, очищает содержимое модального окна и генерирует событие, указывающее, что модальное окно было закрыто.
    - `content:` Свойство, позволяющее установить контент модального окна. Принимает (`HTMLElement`) - контент модального окна.
    - `constructor(container: HTMLElement, events: IEvents):` Конструктор класса. Принимает контейнер модального окна (`HTMLElement`) и объект событий (`IEvents`). Инициализирует элементы модального окна и устанавливает слушатели событий на кнопку закрытия и на само модальное окно.
    - `render(data: IModalData):` Метод рендеринга модального окна с данными. Вызывает родительский метод `render` для установки данных модального окна, затем открывает модальное окно и возвращает его контейнер.

### Класс Success
- Представляет сообщение об успешном выполнении действия и содержит методы и свойства для работы с этим сообщением.
    - `constructor(container: HTMLElement, value: number, actions: IAction):` Конструктор класса. Принимает контейнер сообщения об успешном выполнении действия (`HTMLElement`), значение (`number`), которое будет отображаться в сообщении, и объект действия (`IAction`), содержащий обработчик события клика на кнопке закрытия. Инициализирует элементы сообщения и, если задан обработчик клика, устанавливает слушатель события на кнопку закрытия и устанавливает текстовое описание сообщения.
    - `_close:` Защищенное свойство, представляющее кнопку закрытия сообщения об успешном выполнении действия.
    - `_description:` Защищенное свойство, представляющее текстовое описание сообщения об успешном выполнении действия.

### Класс Page
- Представляет собой компонент страницы, который расширяет базовый компонент Component<IPage>.
   - Создает и инициализирует защищенные свойства `_counter`, `_catalog`, `_wrapper`, `_basket`.
   - Устанавливает обработчик события на клик по элементу `_basket`, чтобы при клике на корзину генерировалось событие `"bids:open"` через объект событий.
   - Устанавливает текст в элемент `_counter`, представляющий счетчик товаров в корзине.

### Класс Card
- Представляет удобный способ управления отображением и данными карточки в приложении.
   - `setId`, `setImage`, `setCategory`, `setTitle`, `setText`, `setButton`, `setPrice`, `setButtonText`: Эти методы устанавливают соответствующие значения для различных частей карточки, таких как идентификатор, изображение, категория, заголовок, текст, кнопка и цена.
   - `getId`, `getTitle`, `getPrice`: Эти методы возвращают значения соответствующих частей карточки.
   - Обработчик событий `(onClick)` добавляется кнопке карточки или самой карточке в зависимости от наличия кнопки.

### Класс Shipping
- Представляет функциональность для управления формой доставки в приложении.
   - `paymentButtons(activeButton)`: Этот метод изменяет стили кнопок оплаты, чтобы выделить активную кнопку.
   - `protected _buttonOnline: HTMLButtonElement`: Кнопка для онлайн оплаты.
   - `protected _buttonUponReceipt: HTMLButtonElement`: Кнопка для оплаты при получении.
   - `set address(value)`: Этот сеттер позволяет установить значение адреса в соответствующее поле формы.

## Слой Preseter
### Класс API
- Это базовый класс, который предоставляет методы для выполнения HTTP-запросов к удаленному API. Давайте рассмотрим основные компоненты этого класса:

    - `ApiListResponse<Type>:` Обобщенный тип, который представляет ответ API, содержащий общее количество элементов (`total`) и массив элементов (`items`) указанного типа `Type`.
    - `ApiPostMethods:` Тип, который описывает возможные методы HTTP-запросов: `'POST'`, `'PUT'` или `'DELETE'`.
    - `Api` класс:
    `baseUrl:` Строка, представляющая базовый URL для всех запросов.
    `options:` Объект RequestInit, содержащий параметры запроса, такие как заголовки и другие настройки.
    - `constructor(baseUrl: string, options: RequestInit = {}):` Конструктор класса, который принимает базовый URL и необязательные настройки запроса. Если настройки не указаны, по умолчанию они пустые.
    - `handleResponse(response: Response): Promise<object>:` Метод для обработки ответа от сервера. Если ответ от сервера успешный (код ответа 2xx), он возвращает разбираемый в JSON объект. Если ответ содержит ошибку, он также разбирает его и возвращает объект ошибки или текстовое сообщение с текстом статуса ответа.
    - `get(uri: string):` Метод для выполнения HTTP-запроса методом GET к указанному URI. Возвращает Promise, который разрешается с данными ответа сервера.
    - `post(uri: string, data: object, method: ApiPostMethods = 'POST'):` Метод для выполнения HTTP-запроса методом POST (по умолчанию) или указанным методом к указанному URI. Принимает данные в формате объекта, который будет отправлен в теле запроса. Возвращает Promise, который разрешается с данными ответа сервера.

### Класс WebLarekAPI
- Представляет взаимодействие с внешним API приложения. Он обеспечивает методы для получения каталога продуктов и размещения заказов, что упрощает работу с данными на стороне сервера.
   - Конструктор класса `WebLarekAPI` принимает `cdn`, `baseUrl` и опции запроса `options`.
   - `setProductsCatalog()`: Этот метод делает запрос к API для получения каталога продуктов. Он возвращает данные, которое вставляются в массив `IProductCard[]`. В ответе к каждому продукту добавляется URL-адрес изображения, объединяя его с `cdn`.
   - `orderProduct(order)`: Этот метод делает POST-запрос к API для размещения заказа.